#include "TxtFile.h"

//----------------------------------------------------------------------//
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//

CTxtFile::CTxtFile()
{
	Initialize(); 
}
 
//----------------------------------------------------------------------//

CTxtFile::~CTxtFile()
{
	Close(); 
}
 
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//

void CTxtFile::Initialize()
{
	hFile = NULL;
}
 
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//

bool CTxtFile::IsOpened()
{
	return hFile != NULL;
}
 
//----------------------------------------------------------------------//

bool CTxtFile::Open(char *fname)
{
	Close();

	hFile = fopen(fname, "rt");

	return IsOpened();
}
 
//----------------------------------------------------------------------//

bool CTxtFile::Create(char *fname)
{
	Close();

	hFile = fopen(fname, "wt+");

	return IsOpened();
}
 
//----------------------------------------------------------------------//

void CTxtFile::Close()
{
	if(IsOpened()){
		fclose(hFile);
		Initialize();
	} 
}
 
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//

bool CTxtFile::ReadChar(char *c)
{
	if(!IsOpened())
		return false;

	int res = fgetc(hFile);

	if(feof(hFile)){
		*c = 0;
		return false;
	} else {
		*c = (char)res;
		return true;
	}
}
 
//----------------------------------------------------------------------//

char* CTxtFile::ReadLine(char *buffer, int size)
{
	if(!IsOpened())
		return NULL;

	return fgets(buffer, size, hFile);
}
 
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//

bool CTxtFile::WriteChar(char c)
{
	if(!IsOpened())
		return false;

	int res = fputc(c, hFile);

	return res != EOF;
}
 
//----------------------------------------------------------------------//

int CTxtFile::WriteLine(char *buffer)
{
	if(!IsOpened())
		return 0;

	int res = fputs(buffer, hFile);

	return res;
}
 
//----------------------------------------------------------------------//

int CTxtFile::WriteArgs(const char *fmt, ...)
{
	if(!IsOpened())
		return 0;

	const int MaxSize = 4096;

	char buf[MaxSize];
	ZeroMemory(buf, MaxSize);

	va_list ap;
	va_start(ap, fmt);
	_vsnprintf(buf, MaxSize, fmt, ap);
	va_end(ap);

	return WriteLine(buf);
}
 
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//
//----------------------------------------------------------------------//

int CTxtFile::Tell()
{
	if(!IsOpened())
		return 0;

	return (int)ftell(hFile);
}
 
//----------------------------------------------------------------------//

void CTxtFile::Flush()
{
	if(IsOpened())
		fflush(hFile); 
}
 

